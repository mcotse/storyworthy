#!/bin/sh
# Lightweight pre-commit hook for Daily Moments app
# Runs TypeScript check and unit tests

# Add bun to PATH if not present
export PATH="$HOME/.bun/bin:$PATH"

echo "Running pre-commit checks..."

# Run TypeScript type check
echo "Checking types..."
if ! bun run build 2>&1 | grep -q "error"; then
  :
else
  bun run build 2>&1 | grep -A2 "error"
  echo "Type check failed. Please fix errors before committing."
  exit 1
fi

# Run unit tests
echo "Running unit tests..."
bun run test:run 2>&1
if [ $? -ne 0 ]; then
  echo "Tests failed. Please fix failing tests before committing."
  exit 1
fi

echo "Pre-commit checks passed!"
